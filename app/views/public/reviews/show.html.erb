<div class="container">
  <div class="row mb-4">
    <div class="col-md-8">
      <%= @review.review %>
    </div>
    <div class="col-md-4">
      <div id="star-rate<%= @review.id %>"></div>
    </div>
  </div>

  <div class="row mb-4">
    <div class="col-md-8">
      <% @review.tags.each do |tag| %>
        <span><%= link_to tag.tag_name, tag_reviews_path(tag_id: tag.id) %></span>
      <% end %>
    </div>
    <div class="col-md-4">
      <% if @review.favorite_by?(current_user) %>
        <%= link_to post_item_review_favorites_path(review_id: @review), method: :delete, class: "btn btn-outline-danger" do %>
          <i class="bi bi-heart-fill"></i> <%= @review.favorites.count %>いいね
        <% end %>
      <% else %>
        <%= link_to post_item_review_favorites_path(review_id: @review), method: :post, class: "btn btn-outline-primary" do %>
          <i class="bi bi-heart"></i> <%= @review.favorites.count %>いいね
        <% end %>
      <% end %>
    </div>
  </div>

  <div class="row mb-4">
    <div class="col-md-8">
      <p>コメント件数：<%= @review.post_comments.count %></p>
      <% @review.post_comments.each do |post_comment| %>
        <div class="card mb-3">
          <div class="card-body">
            <%= post_comment.user.name %>：<%= post_comment.comment %>
            <% if post_comment.user == current_user %>
              <%= link_to "削除", post_item_review_post_comment_path(@review.post_item, post_comment.review, post_comment), method: :delete, class: "btn btn-outline-danger btn-sm ms-3" %>
            <% end %>
          </div>
        </div>
      <% end %>
    </div>
    <div class="col-md-4">
      <%= form_with model: [@review, @post_comment], url: post_item_review_post_comments_path(review_id: @review), method: :post do |f| %>
        <%= f.text_area :comment, rows: "5", placeholder: "コメントをここに", class: "form-control mb-3" %>
        <%= f.submit "コメントを投稿する", class: "btn btn-success" %>
      <% end %>
    </div>
  </div>

  <div class="row">
    <% if current_user != @review.user %>
      <div class="col-md-12">
        <% if current_user.following?(@review.user) %>
          <%= link_to "フォローを外す", user_relationships_path(@review.user_id), method: :delete, class: "btn btn-outline-secondary" %>
        <% else %>
          <%= link_to "この投稿者をフォローする", user_relationships_path(@review.user_id), method: :post, class: "btn btn-outline-primary" %>
        <% end %>
      </div>
    <% end %>
  </div>
</div>

<script>
  $('#star-rate<%= @review.id %>').empty();
  $('#star-rate<%= @review.id %>').raty({
    size: 36,
    starOff: '<%= asset_path('star-off.png') %>',
    starOn: '<%= asset_path('star-on.png') %>',
    starHalf: '<%= asset_path('star-half.png') %>',
    half: true,
    readOnly: true,
    score: <%= @review.evaluation %>,
  })
</script>